# Emby媒体库重复检测工具

一个简单易用、零依赖的 Emby 媒体库重复内容检测与清理工具，专为解决“同大异名”重复文件设计。
![image.png](https://img.huanhq.com/1763725226970_image.png)
![iShot_2025-11-20_15.12.44.png](https://img.huanhq.com/1763622787781_iShot_2025-11-20_15.12.44.png)
![image.png](https://img.huanhq.com/1763609336496_image.png)
![image.png](https://img.huanhq.com/1763724637218_image.png)

## ✨ 核心特性 (v2.5 Ultimate)
- 🎯 **纯体积查重**：忽略文件名差异，只删真正的重复文件。
- 💾 **深度删除**：模拟用户登录，联动 神医助手 物理删除源文件。（请先用神医一键解散合并）
- 🛡️ **安全防误删**：内置 ID 熔断保护，防止因 Emby 自动合并条目导致的误删。
- 🐘 **大文件筛选**：一键找出 >20GB 的电影。
- 🔍 **缺集检测**：自动扫描剧集库，列出缺失集数。
- 🔧 **零依赖**：无需安装 pip 包，无需配置环境，开箱即用。
## 🚀 快速开始

### 方法一：单行命令运行（推荐）

这是最快、最稳定的启动方式。脚本会自动在您的家目录下创建数据文件夹。

```
# 适用于所有 Linux 发行版 / macOS
python3 -u <(curl -sL https://raw.githubusercontent.com/huanhq99/emby-scanner/main/emby_scanner.py)
```
## 📖 功能菜单

- 🚀 **开始扫描重复**：检测重复文件，显示库容量。提供 自动批量删除 (保留长命名) 和 手动精选 两种模式。
- 🔍 **缺集检查**：扫描剧集库，生成缺集报告。
- 🧹 **垃圾清理**：清理空文件夹。
- 📊 **媒体库透视**：统计分辨率与编码分布。
- 🐘 **大文件筛选**：筛选超大电影文件。

## 📋 使用指南

### 1. 初始化配置

首次运行会自动进入向导，请输入：

- **Emby 地址**：例如 `http://192.168.1.100:8096` 或 `https://emby.yourdomain.com`
- **API 密钥**：在 Emby 后台 -> 高级 -> API 密钥 中生成。

### 2. 扫描与清理流程

1. 在主菜单选择 `[1] 🚀 开始扫描`。
2. 脚本将遍历所有媒体库，显示每个库的**总容量**和**重复占用的空间**。
3. 如果发现重复，脚本会提示进入清理模式。
4. 选择 `手动精选模式`，脚本会列出重复组的详细信息（分辨率、编码、路径）。
5. **选择删除方式**：推荐使用 **[3] 立即登录删除**，输入管理员账号密码。这会模拟网页端操作，通知 Emby 及联动工具删除源文件。

### 3. 文件存储位置

所有配置文件和扫描报告都统一保存在：

- **路径**：`~/emby_scanner_data/` (即您的用户家目录下的 `emby_scanner_data` 文件夹)
- **文件**：
    - `emby_config.json`: 服务器配置
    - `report_yyyymmdd_xxxx.txt`: 详细扫描报告
    - `clean_script_xxxx.sh`: 生成的清理脚本（如果是本地模式）

## 📊 报告示例 (Size-Only 模式)

```
🎬 Emby 媒体库重复检测报告
======================================================
生成时间: 2025-11-19 12:00:00
检测逻辑: 仅基于文件体积 (Size) 匹配

📁 媒体库: 华语电影 | 库占用: 35.50 TB
🔴 发现 1 组体积完全一致的文件:

  📦 单文件体积: 10.48 GB | 冗余: 1 份 (共 2 个文件)
    - 消失的她 (2023) [MKV | 1080P | HEVC]
      路径: /mnt/media/movies/华语/消失的她.mkv
    - 消失的她_copy (2023) [MKV | 1080P | HEVC]
      路径: /mnt/download/temp/消失的她 (1).mkv

----------------------------------------

📁 媒体库: 欧美剧 | 库占用: 81.02 TB
✅ 该库未发现体积重复。

======================================================
共发现 1 组重复，可释放空间: 10.48 GB。

```

## ❓ 常见问题
**Q: “登录删除”安全吗？会不会盗号？**
A: 绝对安全。

1. 您的密码仅在运行时用于获取一次性 `Access Token`，**不会被保存**到任何文件。
2. 脚本是开源的，您可以随时审查代码逻辑。

**Q: 为什么我有两个文件体积一样，但脚本没扫出来？**
A: 脚本执行的是**字节级**对比。如果文件大小差 1 个字节（例如元数据不同），也会被视为不同文件。这是为了防止误删不同版本的影片（如 1080P 和 4K 版本体积通常不同）。

**Q: 连接服务器失败？**
A: 请检查：

- 地址是否包含 `http://` 或 `https://`。
- API 密钥是否有权限。
- 如果是 Docker 容器，请确认网络互通。

## 🤝 贡献与反馈

如果您遇到问题或有改进建议：

1. 在 GitHub Issues 提交反馈，请附上报错截图。
2. 欢迎 Fork 本仓库并提交 Pull Request。

## 📄 许可证

MIT License

## 🔗 相关链接

- [GitHub 仓库](https://github.com/huanhq99/emby-scanner)
- [Emby 官网](https://emby.media/)

*注意: 本工具仅供个人学习与媒体库维护使用，请在执行删除操作前务必确认文件列表。*
